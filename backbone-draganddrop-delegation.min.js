(function($){var event,getEvent=function(){return event||window.event},setEvent=function(ev){event=ev};if(navigator.userAgent.toLowerCase().indexOf('firefox')>=0){window.addEventListener('mousedown',setEvent,true)}$.fn.extend({detectDrag:function(){var isDragging=false,dragStart=null,$clone=null,$el=null,data={set:function(value){data=value}},$dragoverElement=null,preventSelection=function(event){event.preventDefault();return false},dragDetected=function(event){return(Math.abs(dragStart.clientX-event.clientX)>5||Math.abs(dragStart.clientY-event.clientY)>5)},startDrag=function(event){isDragging=true;$clone=$el.clone().css({position:'absolute',left:event.clientX+5,top:event.clientY+5}).appendTo('body');$el.trigger('dragstart',[data,$clone,$el])},drag=function(event){var $target=$(event.target),isNewTarget=$target[0]!==($dragoverElement?$dragoverElement[0]:null);if($target.attr('dropable')&&isNewTarget){$dragoverElement=$target;$target.trigger('dragenter',[$clone,$el])}else if($dragoverElement&&isNewTarget){$dragoverElement.trigger('dragleave',[$clone,$el]);$dragoverElement=null}$clone.css({left:event.clientX+5,top:event.clientY+5})},handleDrag=function(event){if(isDragging){drag(event)}else if(dragDetected(event)){startDrag(event)}},stopDrag=function(event){var $target=$(event.target),$window=$(window);if(isDragging){$clone.remove();if($target.attr('dropable')){$target.trigger('drop',[data,$clone,$el])}else{$el.trigger('dragend',[$clone,$el])}}isDragging=false;$el.off('selectstart',preventSelection);$('body').css('user-select','auto');$window.off('mousemove',handleDrag).off('mouseup',stopDrag)};dragStart=getEvent();$el=$(this);$el.on('selectstart',preventSelection);$('body').css('user-select','none');$(window).on('mousemove',handleDrag).on('mouseup',stopDrag)}})}(jQuery));